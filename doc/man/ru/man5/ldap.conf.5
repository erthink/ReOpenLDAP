.TH LDAP.CONF 5 "RELEASEDATE" "ReOpenLDAP LDVERSION"
.\" $ReOpenLDAP$
.\" Copyright (c) 2015,2016 Leonid Yuriev <leo@yuriev.ru>.
.\" Copyright (c) 2015,2016 Peter-Service R&D LLC <http://billing.ru/>.
.\"
.\" This file is part of ReOpenLDAP.
.\"
.\" ReOpenLDAP is free software; you can redistribute it and/or modify it under
.\" the terms of the GNU Affero General Public License as published by
.\" the Free Software Foundation; either version 3 of the License, or
.\" (at your option) any later version.
.\"
.\" ReOpenLDAP is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU Affero General Public License for more details.
.\"
.\" You should have received a copy of the GNU Affero General Public License
.\" along with this program.  If not, see <http://www.gnu.org/licenses/>.
.\"
.\" ---
.\"
.\" Copyright 1998-2014 The OpenLDAP Foundation All Rights Reserved.
.\" Copying restrictions apply.  See COPYRIGHT/LICENSE.
.SH НАЗВАНИЕ
ldap.conf, .ldaprc \- конфигурационный файл/переменные окружения для LDAP-клиентов
.SH ОБЗОР
ETCDIR/ldap.conf, ldaprc, .ldaprc, $LDAP<option-name>
.SH ОПИСАНИЕ
Если определена переменная окружения \fBLDAPNOINIT\fP,
все заданные значения по умолчанию не применяются.
.LP
Конфигурационный файл
.I ldap.conf
используется для задания общесистемных значений по умолчанию,
применяемых при запуске
.IR ldap-клиентов .
.LP
Пользователи могут создавать в своих домашних директориях
опциональные конфигурационные файлы
.I ldaprc
или
.IR .ldaprc ,
которые будут использованы для переопределения
значений по умолчанию из общесистемного файла.
Кроме того, будут применяться значения из файла
.I ldaprc
в текущей рабочей директории.
.LP
.LP
С помощью переменных окружения \fBLDAPCONF\fP и \fBLDAPRC\fP
можно указать использование дополнительных конфигурационных файлов.
В переменной \fBLDAPCONF\fP может быть задан путь к конфигурационному файлу.
Этот путь может быть как абсолютным, так и относительным (от текущей рабочей директории).
Если указывается переменная \fBLDAPRC\fP, то в ней должно быть задано имя файла
в текущей рабочей директории или в домашней директории пользователя.
.LP
Для переопределения значений по умолчанию из файлов можно также использовать переменные окружения.
Имя такой переменной представляет собой имя опции файла с добавлением префикса \fBLDAP\fP.
Например, для определения опции \fBBASE\fP через окружение, нужное значение указывается в переменной
\fBLDAPBASE\fP.
.LP
Некоторые опции может задавать только пользователь. Такие опции игнорируются при их указании в
.I ldap.conf
(или файле, заданном в переменной
.BR LDAPCONF ).
.LP
Итак, файлы и переменные будут прочитаны в следующем порядке:
.nf
    переменная              $LDAPNOINIT, и, если она не задана, то:
    системный файл          ETCDIR/ldap.conf,
    пользовательские файлы  $HOME/ldaprc,  $HOME/.ldaprc,  ./ldaprc,
    системный файл          $LDAPCONF,
    пользовательские файлы  $HOME/$LDAPRC, $HOME/.$LDAPRC, ./$LDAPRC,
    переменные              $LDAP<имя опции заглавными буквами>.
.fi
Более поздние в списке установки переопределяют более ранние.
.SH СИНТАКСИС
Названия опций конфигурации нечувствительны к регистру символов;
их значения, в зависимости от ситуации, могут быть чувствительны к регистру символов.
.LP
Пустые строки игнорируются.
.br
Строки, начинающиеся с символа решётки (`#'), являются комментариями и игнорируются.
.LP
Значимые строки состоят из названия опции (последовательности непробельных символов,
по традиции записываемых в верхнем регистре, хотя такое требование не выдвигается),
за которым следует значение. Значение начинается с первого непробельного символа после названия опции
и завершается в конце строки, либо перед первым пробельным символом последовательности пробельных символов,
которыми завершается строка. Разбиение значения на составляющие, если таковые имеются,
делегируется определённому для этой опции обработчику (обработчикам), опять же, при их наличии.
Значения в кавычках, содержащие пробельные символы, могут быть некорректными,
поскольку символ кавычек может стать частью значения. Например,

.nf
	# Неверно - ошибочные кавычки:
	URI     "ldap:// ldaps://"

	# Верно - разделённый пробелами список URI, без кавычек:
	URI     ldap:// ldaps://

	# Верно - синтаксис DN требует заключать в кавычки Example, Inc:
	BASE    ou=IT staff,o="Example, Inc",c=US
	# или:
	BASE    ou=IT staff,o=Example2C Inc,c=US

	# Неверно - комментарий на одной строке с опцией:
	DEREF   never           # Never follow aliases
.fi
.LP
Строка не может быть длиннее значения LINE_MAX, которое должно превышать 2000 на всех платформах.
Не предусмотрено механизмов разбиения длинной строки на несколько строк
(как в целях повышения читабельности, так и в целях недопущения превышения указанного лимита).
.SH ОПЦИИ
Опции конфигурации различного назначения:
.TP
.B URI <ldap[si]://[name[:port]] ...>
Указывает URI (один или несколько) LDAP-сервера (серверов), к которым следует осуществлять подключение библиотеке
.IR LDAP .
В качестве схемы в URI могут быть
.BR ldap ,
.B ldaps
или
.BR ldapi ,
указывающие, соответственно, на подключения LDAP поверх TCP, LDAP поверх SSL (TLS) и LDAP поверх IPC
(доменных сокетов UNIX). Каждое имя сервера может быть указано как доменное имя или как IP-адрес.
Опционально, за именем сервера может следовать знак ':' и номер порта, на котором ожидает подключения LDAP-сервер.
Если номер порта не указан, используется значение порта по умолчанию для конкретного вида схемы
(389 для ldap://, 636 для ldaps://). Для LDAP поверх IPC аргумент
.B name
представляет собой имя сокета, а аргумент
.B port
указывать нельзя; обратите внимание, что разделительные символы директорий должны быть закодированы в формате URL,
как и все остальные символы, являющиеся специальными для URL; таким образом, сокет

	/usr/local/var/ldapi

должен быть указан как

	ldapi://%2Fusr%2Flocal%2Fvar%2Fldapi

В данной опции может быть предоставлен список URI, разделённых пробелами.
.TP
.B BASE <base>
Определяет базовое DN, использующееся по умолчанию при выполнении операций ldap.
Аргумент base должен быть указан как уникальное имя (Distinguished Name) в формате LDAP.
.TP
.B BINDDN <dn>
Определяет DN подключения, использующееся по умолчанию при выполнении операций ldap.
DN подключения должен быть указан как уникальное имя (Distinguished Name) в формате LDAP.
.B Эту опцию может задавать только пользователь.
.TP
.B DEREF <when>
Определяет, как будет осуществляться разыменование псевдонимов при выполнении поиска.
В качестве аргумента
.B <when>
может быть указано одно из следующих ключевых слов:
.RS
.TP
.B never
Псевдонимы не разыменовываются никогда. Это значение по умолчанию.
.TP
.B searching
Псевдонимы разыменовываются, если они встречаются в нижестоящих по отношению к базе поиска объектах,
но не разыменовываются при нахождении самого объекта базы поиска.
.TP
.B finding
Псевдонимы разыменовываются только при нахождении объекта базы поиска.
.TP
.B always
Псевдонимы разыменовываются как при осуществлении поиска, так и при нахождении объекта базы поиска.
.RE
.TP
.TP
.B HOST <name[:port] ...>
Указывает имя (имена) LDAP-сервера (серверов), к которым следует осуществлять подключение библиотеке
.IR LDAP .
Каждое имя сервера может быть указано как доменное имя или как IP-адрес.
Опционально, за именем сервера может следовать знак ':' и номер порта, на котором ожидает подключения
LDAP-сервер. В данной опции может быть предоставлен список хостов, разделённых пробелами. Опция
.B HOST
считается устаревшей в пользу
.BR URI .
.TP
.B NETWORK_TIMEOUT <integer>
Указывает тайм-аут (в секундах), после которого вслед за вызовом connect(2),
в случае отсутствия активности, возвращаются poll(2)/select(2).
.TP
.B PORT <port>
Определяет порт по умолчанию, используемый при соединении с LDAP-сервером (серверами).
В качестве аргумента port указывается номер порта. Опция
.B PORT
считается устаревшей в пользу
.BR URI.
.TP
.B REFERRALS <on/true/yes/off/false/no>
Указывает, должен ли клиент автоматически следовать по отсылкам, возвращаемым LDAP-серверами.
Значение по умолчанию - on. Имейте ввиду, что инструменты командной строки, такие как
.BR ldapsearch (1),
всегда переопределяют эту опцию.
.\" This should only be allowed via ldap_set_option(3)
.\".TP
.\".B RESTART <on/true/yes/off/false/no>
.\"Determines whether the library should implicitly restart connections (FIXME).
.TP
.B SIZELIMIT <integer>
Определяет ограничение по размеру (указывается в количестве записей), которое следует использовать
при выполнении поиска. В качестве аргумента должно быть неотрицательное целое число. Значение ноль (0) опции
\fISIZELIMIT\fP указывает на то, что ограничений по размеру при выполнении поиска не запрашивается.
Помните, что сервер может также применять свои ограничения на количество записей,
которые могут быть возвращены операцией поиска.
.TP
.B TIMELIMIT <integer>
Определяет ограничение по времени (в секундах), которое следует использовать при выполнении поиска.
В качестве аргумента должно быть неотрицательное целое число. Значение ноль (0) опции
\fITIMELIMIT\fP указывает на то, что ограничений по размеру при выполнении поиска не накладывается.
Помните, что сервер может также применять свои ограничения на продолжительность выполнения операции поиска.
.TP
.B VERSION {2|3}
Указывает, какую версию протокола LDAP следует использовать.
.TP
.B TIMEOUT <integer>
Указывает тайм-аут (в секундах), после которого вызовы команд синхронного API LDAP,
на которые не получены ответы, будут прерваны. Также используются для любых вызовов
.BR ldap_result (3),
в которых параметру timeout было задано значение NULL.
.SH ОПЦИИ SASL
Если ReOpenLDAP собран с поддержкой Simple Authentication and Security Layer,
можно определить дополнительные опции:
.TP
.B SASL_MECH <mechanism>
Указывает, какой механизм SASL следует использовать.
.B Эту опцию может задавать только пользователь.
.TP
.B SASL_REALM <realm>
Указывает SASL-realm.
.B Эту опцию может задавать только пользователь.
.TP
.B SASL_AUTHCID <authcid>
Указывает аутентификационную идентификационную сущность.
.B Эту опцию может задавать только пользователь.
.TP
.B SASL_AUTHZID <authcid>
Указывает прокси-авторизационную идентификационную сущность.
.B Эту опцию может задавать только пользователь.
.TP
.B SASL_SECPROPS <properties>
Определяет параметры безопасности Cyrus SASL. В аргументе
.B <properties>
может быть указан разделённый запятыми список следующих параметров:
.RS
.TP
.B none
(без указания каких-либо других параметров) приводит к сбросу параметров по умолчанию
("noanonymous,noplain").
.TP
.B noplain
отключает механизмы, потенциально неустойчивые к простым пассивным атакам.
.TP
.B noactive
отключает механизмы, потенциально неустойчивые к активным атакам.
.TP
.B nodict
отключает механизмы, потенциально неустойчивые к простым атакам по словарю.
.TP
.B noanonymous
отключает механизмы, поддерживающие анонимные соединения.
.TP
.B forwardsec
требует обеспечения так называемой прямой секретности (forward secrecy) между сессиями.
.TP
.B passcred
требует использования механизмов, осуществляющих передачу удостоверяющих данных клиента
(и, для осуществления этого, разрешает механизмы, способные передавать удостоверяющие данные).
.TP
.B minssf=<factor>
указывает минимально приемлемый
.I фактор силы безопасности (security strength factor)
в виде целого числа, приблизительно отражающего эффективную длину ключа, используемого для шифрования.
0 (ноль) подразумевает отсутствие защиты, 1 подразумевает только защиту целостности данных,
56 разрешает использование DES или других слабых шифров, 112 разрешает использование
Triple DES и других сильных шифров, 128 разрешает использование RC4, Blowfish
и других современных сильных шифров. Значение по умолчанию - 0.
.TP
.B maxssf=<factor>
указывает максимально возможный
.I фактор силы безопасности (security strength factor)
в виде целого числа (смотрите описание опции
.BR minssf ).
Значение по умолчанию -
.BR INT_MAX .
.TP
.B maxbufsize=<factor>
определяет максимально разрешённый размер буфера полученных уровней обеспечения безопасности.
Значение 0 отключает уровни обеспечения безопасности. Значение по умолчанию - 65536.
.RE
.SH ОПЦИИ GSSAPI
Если ReOpenLDAP собран с поддержкой Generic Security Services Application Programming Interface,
есть возможность определить дополнительные опции.
.TP
.B GSSAPI_SIGN <on/true/yes/off/false/no>
Указывает, следует ли использовать подписи GSSAPI (GSS_C_INTEG_FLAG).
Значение по умолчанию - off.
.TP
.B GSSAPI_ENCRYPT <on/true/yes/off/false/no>
Указывает, следует ли использовать шифрование GSSAPI (GSS_C_INTEG_FLAG и GSS_C_CONF_FLAG).
Значение по умолчанию - off.
.TP
.B GSSAPI_ALLOW_REMOTE_PRINCIPAL <on/true/yes/off/false/no>
Указывает, следует ли основанной на GSSAPI аутентификации пытаться формировать
имя целевого принципала из значений атрибутов ldapServiceName или dnsHostName
записи RootDSE каталога, содержащего целевой объект. Значение по умолчанию - off.
.SH ОПЦИИ TLS
Если ReOpenLDAP собран с поддержкой Transport Layer Security, есть возможность определить
дополнительные опции. Эти опции используются, когда при соединении выбран URI
.B ldaps://
(по умолчанию или явно), или когда приложение устанавливает TLS путём запроса операции LDAP StartTLS.
.TP
.B TLS_CACERT <filename>
Указывает файл, содержащий сертификаты всех удостоверяющих центров (Certificate Authorities),
которым доверяет клиент.
.TP
.B TLS_CACERTDIR <path>
Указывает путь к директории, содержащей сертификаты всех удостоверяющих центров
в отдельных файлах. Сертификаты, указанные в опции
.BR TLS_CACERT ,
всегда используются перед теми, путь к которым указан в опции
.BR TLS_CACERTDIR .
Библиотека GnuTLS игнорирует эту опцию.

При использовании библиотеки Mozilla NSS аргумент <path> может содержать путь к базе данных
сертификатов/ключей Mozilla NSS. Если аргумент <path> содержит пути и к базе данных
сертификатов/ключей Mozilla NSS, и к файлам сертификатов удостоверяющих центров, ReOpenLDAP будет
использовать базу данных сертификатов/ключей, а файлы сертификатов удостоверяющих центров
проигнорирует.
.TP
.B TLS_CERT <filename>
Указывает файл, содержащий сертификат клиента.
.B Эту опцию может задавать только пользователь.

При использовании библиотеки Mozilla NSS и базы данных сертификатов/ключей (указанной в опции
TLS_CACERTDIR), TLS_CERT определяет имя сертификата, который нужно использовать:
.nf
	TLS_CERT Certificate for Sam Carter
.fi
Если используется токен, отличный от встроенного внутреннего, сначала указывается имя этого
токена, за которым следует двоеточие:
.nf
	TLS_CERT my hardware device:Certificate for Sam Carter
.fi
Для получения списка имён сертификатов используйте certutil -L:
.nf
	certutil -d /path/to/certdbdir -L
.fi
.TP
.B TLS_KEY <filename>
Указывает файл, содержащий закрытый ключ, соответствующий сертификату,
хранящемуся в файле, указанном в опции
.BR TLS_CERT .
В настоящее время данный закрытый ключ должен не иметь парольной защиты,
поэтому критически важное значение имеет защита самого файла с ключом.
.B Эту опцию может задавать только пользователь.

При использовании библиотеки Mozilla NSS, TLS_KEY указывает имя файла, содержащего пароль для ключа,
соответствующего сертификату, указанному в опции TLS_CERT. Для отключения парольной защиты
базы данных сертификатов/ключей можно использовать команду modutil. Например, если в опции
TLS_CACERTDIR в качестве расположения базы данных сертификатов/ключей указано /home/scarter/.moznss,
то для смены пароля на пустую строку используйте:
.nf
	modutil -dbdir ~/.moznss -changepw 'NSS Certificate DB'
.fi
Вы должны знать предыдущий пароль, если он был установлен. Предупреждение о запуске браузера следует
проигнорировать. На запрос нового пароля нажмите 'Enter'.

.TP
.B TLS_CIPHER_SUITE <cipher-suite-spec>
Указывает допустимый набор шифров в порядке их предпочтения. Аргумент <cipher-suite-spec>
должен представлять собой спецификацию шифров для используемой библиотеки TLS
(OpenSSL, GnuTLS или Mozilla NSS). Примеры:
.RS
.RS
.TP
.I OpenSSL:
TLS_CIPHER_SUITE HIGH:MEDIUM:+SSLv2
.TP
.I GnuTLS:
TLS_CIPHER_SUITE SECURE256:!AES-128-CBC
.RE

Для проверки того, какие шифры доступны в данной спецификации OpenSSL, используйте команду:

.nf
	openssl ciphers \-v <cipher-suite-spec>
.fi

В GnuTLS доступные спецификации можно найти в man-странице
.BR gnutls\-cli (1)
(смотрите описание опции
.BR \-\-priority ).

В старых версиях библиотеки GnuTLS, где утилита gnutls\-cli не поддерживала опции
\-\-priority, можно получить \(em ограниченный \(em список шифров командой:

.nf
	gnutls\-cli \-l
.fi

При использовании библиотеки Mozilla NSS применяются спецификации наборов шифров OpenSSL,
которые транслируются в формат, используемый внутри библиотеки Mozilla NSS. Не существует
простого способа получить список наборов шифров из командной строки. Полный список можно
найти в исходном коде Mozilla NSS, файл sslinfo.c, структура
.nf
        static const SSLCipherSuiteInfo suiteInfo[]
.fi
.RE
.TP
.B TLS_PROTOCOL_MIN <major>[.<minor>]
Указывает минимальную версию протокола SSL/TLS, которая будет использоваться для установки
защищённого соединения. Если сервер не поддерживает как минимум данную версию протокола,
переговоры SSL будут завершаться неудачей. Чтобы указать необходимость использования
TLS 1.x или выше, задайте в качестве аргумента этой опции 3.(x+1), то есть при

.nf
	TLS_PROTOCOL_MIN 3.2
.fi

требуется использовать TLS 1.1. Если в качестве минимально допустимой указана та версия
протокола, которая не поддерживается данной реализацией ReOpenLDAP, то в итоге будет
требоваться та наибольшая версия протокола, которую ReOpenLDAP поддерживает.
Библиотека GnuTLS игнорирует эту опцию.
.TP
.B TLS_RANDFILE <filename>
Указывает файл, из которого будут получены случайные данные, в случаях,
когда /dev/[u]random недоступен. Обычно задаёт имя сокета EGD/PRNGD.
Для указания имени файла источника случайных данных также может быть использована
переменная окружения RANDFILE. Библиотеки GnuTLS и Mozilla NSS игнорируют эту опцию.
.TP
.B TLS_REQCERT <level>
Определяет, какие проверки требуется (и требуется ли вообще) выполнить с сертификатом сервера
в сессии TLS. В качестве аргумента
.B <level>
может быть использовано одно из следующих ключевых слов:
.RS
.TP
.B never
Клиент не будет запрашивать или проверять какие-либо сертификаты сервера.
.TP
.B allow
Сертификат сервера будет запрошен. Если сертификат не был предоставлен,
сессия будет продолжена нормальным образом. Если же был предоставлен плохой сертификат,
он будет проигнорирован и сессия будет продолжена нормальным образом.
.TP
.B try
Сертификат сервера будет запрошен. Если сертификат не был предоставлен,
сессия будет продолжена нормальным образом. Если же был предоставлен плохой сертификат,
сессия будет немедленно завершена.
.TP
.B demand | hard
Эти ключевые слова эквивалентны. Сертификат сервера будет запрошен.
Если сертификат не был предоставлен либо был предоставлен плохой сертификат,
сессия будет немедленно завершена. Данная настройка используется по умолчанию.
.RE
.TP
.B TLS_CRLCHECK <level>
Определяет, следует ли использовать предоставляемые удостоверяющими центрами
списки отзыва сертификатов (Certificate Revocation List, CRL) для проверки того,
не был ли отозван сертификат сервера. Для использования данной опции требуется указание опции
.BR TLS_CACERTDIR .
Библиотеки GnuTLS и Mozilla NSS игнорируют эту опцию. В качестве аргумента
.B <level>
может быть использовано одно из следующих ключевых слов:
.RS
.TP
.B none
Проверка CRL не выполняется.
.TP
.B peer
Выполняется проверка только CRL удостоверяющего центра, выдавшего сертификат сервера.
.TP
.B all
Выполняется проверка CRL всей цепочки сертификатов.
.RE
.TP
.B TLS_CRLFILE <filename>
Указывает файл, содержащий список отозванных сертификатов, который нужно использовать для проверки
того, не был ли отозван сертификат сервера. Эта опция поддерживается только библиотеками
GnuTLS и Mozilla NSS.
.SH "ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ"
.TP
LDAPNOINIT
сбросить все установки по умолчанию.
.TP
LDAPCONF
путь к конфигурационному файлу.
.TP
LDAPRC
имя альтернативного для ldaprc файла в директориях $HOME или $CWD.
.TP
LDAP<option-name>
задать (переопределить) опцию <option-name> как в файле ldap.conf.
.SH ФАЙЛЫ
.TP
.I  ETCDIR/ldap.conf
общесистемный файл конфигурации ldap
.TP
.I  $HOME/ldaprc, $HOME/.ldaprc
пользовательский файл конфигурации ldap
.TP
.I  $CWD/ldaprc
локальный файл конфигурации ldap
.SH "СМОТРИТЕ ТАКЖЕ"
.BR ldap (3),
.BR ldap_set_option (3),
.BR ldap_result (3),
.BR openssl (1),
.BR sasl (3)
.SH АВТОР
Kurt Zeilenga, Проект OpenLDAP
.SH "ПРИЗНАНИЕ ЗАСЛУГ"
.so ../Project
